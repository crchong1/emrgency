<!DOCTYPE html>
<html>
<head>
  <style>


  
  .nav {
    background-color:rgba(0,0,0,0.2) !important;
    border-color: transparent !important;
    background-image:none !important;
    color:white !important;
  }
  .nav .btn {
    background-color: rgba(255, 255, 255, 0) !important;
    color: rgb(255, 255, 255);
    border-color: rgba(255, 255, 255, 0.205)!important;
  }
  .nav li{
    padding-left:30px;
    padding-right:20px;
  }
  .nav a{
    color:white !important;
  }
  .nav input{
    background-color: rgba(255, 255, 255, 0.171);
    border-color: transparent !important;
  }
  .nav ::placeholder {
    color:white !important;
  }



  .sticky {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
  }

  .sticky:before,
  .sticky:after {
    content: '';
    display: table;
  }
  .sidebarContainer {
  }
  .sidebar {
    fill: solid;
    background: #24345E;
    color: white;
  }
  .basicInfo {
    padding-left: 30px;
    padding-right: 40px;
    padding-top: 66px;
    padding-bottom: 100px; 
  }
  .active {
  }
  .links {
    display: block !important;
  }
  .header {
    display: inline-block;
  }
  .hdrBtns {
    display: inline-block;
    float:right;  }
    .Rplus {
      font-size: 48px;
    }
    .background {
      background-color: #E1EBF2
    }
    .box {
      margin-left: 10px;
      margin-right: 20px;
      margin-top: 10px;
      margin-bottom: 10px;
      padding: 15px;
    }
    .summary {
      font-size: 48px;
    }
    .topRight {
      position: absolute;
      top: 5px;
      right:10px;
    }
    .med {
      margin: 10px !important;
      margin-bottom: 25px !important;
    }
  </style>
  <title>Patient Page</title>


  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Pacifico"/>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
  <script type="text/javascript" src="/files/js/stickyfillmin.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>


</head>
<body style="background-color: #E1EBF2;"> 
  <div class="background">
    <div class="sidebarContainer">
      <div class="row">
        <nav class="col-sm-2 sidebar">
          <div class = "sidebar sticky " >
            <div class = "basicInfo"> 
              <h2 id = "name"> Patient Name </h2>

              <p id="ageDOB"> Age: ###, DOB: ##-##-####</p>
              <p id="sexWH"> Female, ###.# kg, ### cm </p>
              <p id="allergiesSide"> Shellfish </p>

            </div>

            <ul class="nav nav-pills nav-stacked links">
              <li class="active">
                <a href="patientPage">Patient Summary</a></li>
                <li><a href="#section2">Social History</a></li>
                <li><a href="problemList">Problem List</a></li>
                                <li><a href="allergies">Allergies</a></li>
                <li><a href="#section4">Immunization Record</a></li>
                <li><a href="#section3">Well Child Check</a></li>
                <li><a href="#section5">Testing</a></li>
                <li><a href="#section6">Growth Charts</a></li>
                <li><a href="#section7">Nurse Notes</a></li>
                <li><a href="#section8">Scans</a></li>

              </ul>
            </div>
          </nav>
          <div class="col-lg">   

            <div class = "card header">
             <div class = "topRight">
              <p> Welcome, "User Name"  | </p>
              <button> Logout </button>
            </div>

            <div class = "Rplus header"> R+ Childrens </div>

            <div class = "hdrBtns header">
             <a href="#Pharmacy">Pharmacy</a>
             <a href="#AllPatients">All Patients</a>
             <a href="#AddPatient">Add Patient</a>
           </div>

         </div>


         <div class = "card box summary"> 
          <h3> Allergies </h3>

        </div>

        <div id = "allergies" class="card med">
          <div class="card-header">
           <h3> </h3>
           <div class="row">
            <div class="col-sm"> Allergen </div>
            <div class="col-sm"> Type of Reaction </div>
            <div class="col-sm"> Severity </div>
            <div class="col-sm"> Onset of Reaction </div>
            <div class="col-sm"> Notes </div>

          </div>
        </div>

      </div>



    <div id = "chronicProb" class="card med">
      <div class="card-header">
       <h3> Other card? </h3>
       <div class="row">
        <div class="col-sm"> Diagnosis </div>
        <div class="col-sm"> Treatment </div>
        <div class="col-sm"> Dose </div>
        <div class="col-sm"> Time </div>
        <div class="col-sm"> Route </div>
        <div class="col-sm"> Date of Onset </div>
        <div class="col-sm"> Date of Resolution </div>
        <div class="col-sm"> Duration </div>
      </div>
    </div>

  </div>




</div>

</body>


<script>


 $(document).ready(function(){


  var elements = document.querySelectorAll('.sticky');
  Stickyfill.add(elements);
            // Initial Page Load


            $.ajax({
              type: 'POST',
              url: '/getPatientKeys',
              data: {
                search: '',
                field: 'lastName',
              },
              success: function(result) {
                patients = result.patient;
                getPatientData(result.patient);
              }
            });



          });



 var getPatientData = function(patient) {
  var temp = patient;
  var medication = [{name: 'Cetirizine', dose: '100 mg', time: 'daily 8 am', route: 'PO', start: '1-12-2017', end: '1-12-2019', duration: "2 years"}, {name: 'Cetaphyl', dose: '200 mg', time: 'daily 9 am', route: 'PO', start: '1-12-2016', end: '1-12-2019', duration: "2 years"}];

  var allergies = [{allergen: 'dairy', severity: 'Mild', note: 'Avoid diary products'}]


  var acute = [{diagnosis: 'fungal infection', treatment: 'Ketanocozole', dose: '1 cc propanol', time: 'BID', route: 'Topical', start: '1-12-2017', end: '1-12-2019', duration: "1 month"}];

var allergies = [{allergen: 'peanut', severity: 'mild', reaction: 'throat closure', onsent: '12-08-2009', notes: 'avoid tree nuts in general, especially almonds'}];
  console.log('here:' + patient);
  var cards = "";
  var date = new Date(2018,2,12);
  var i = 1;
  var patient = patient[i];
  $('#name').text(patient.firstName + ' ' + patient.lastName);
  $('#ageDOB').text('Age: ' + getAge(patient.birthdate) + ',  ' + 'DOB: ' + patient.birthdate)
  
  $('#sexWH').text('Sex: ' +  'female' + ',  Weight: ' + patient.weight + " kgs,  Height: " + patient.height + " cm" );
  $('#allergiesSide').text('Allergies: ' + allergies[0].allergen );



  var allergiesCard = '<div class="box">' +
  '<div class="row"><div class="col-sm">' + allergies[0].allergen + 
  '</div> <div class="col-sm">' + allergies[0].severity + 
  '</div><div class="col-sm">' + allergies[0].reaction +
  '</div> <div class="col-sm">' + allergies[0].onsent +
  '</div> <div class="col-sm ">' + allergies[0].notes +
 '</div></div>' ;

  

  $('#allergies').append(allergiesCard);




  var chronicCard = '<div class="box">' +
  '<div class="row"><div class="col-sm">' + chronic[0].diagnosis + 
  '</div> <div class="col-sm">' + chronic[0].treatment + 
  '</div> <div class="col-sm">' + chronic[0].dose + 
  '</div> <div class="col-sm">' + chronic[0].time +
  '</div> <div class="col-sm">' + chronic[0].route +
  '</div> <div class="col-sm">' + chronic[0].start +
  '</div> <div class="col-sm">' + chronic[0].end +
  '</div> <div class="col-sm">' + chronic[0].duration + '</div></div>' ;
  


  $('#chronicProb').append(chronicCard);
};



                   //   document.getElementById('patientCards').innerHTML = cards;




                   function getAge(fromdate, todate){
                    if(todate) todate= new Date(todate);
                    else todate= new Date();

                    var age= [], fromdate= new Date(fromdate),
                    y= [todate.getFullYear(), fromdate.getFullYear()],
                    ydiff= y[0]-y[1],
                    m= [todate.getMonth() + 1, fromdate.getMonth()],
                    mdiff= m[0]-m[1],
                    d= [todate.getDate(), fromdate.getDate()],
                    ddiff= d[0]-d[1];

                    if(mdiff < 0 || (mdiff=== 0 && ddiff<0))--ydiff;
                    if(mdiff<0) mdiff+= 12;
                    if(ddiff<0){
                      fromdate.setMonth(m[1]+1, 0);
                      ddiff= fromdate.getDate()-d[1]+d[0];
                      --mdiff;
                    }
                    w = Math.floor(ddiff/7);
                    ddiff = ddiff % 7;
                  // 3 or older -> show year
                  if (ydiff > 2) age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
                  else if (ydiff> 0) {
                    // Over a year -> show year and month
                    age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
                    if(mdiff> 0) age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
                    // Less than a year -> show month and day
                  } else if (mdiff> 3) {
                   age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
                   if (w> 0) age.push(w+ ' week' + (w> 1? 's':''));
                 } else if (mdiff>0) {
                  age.push(mdiff+ ' month'+(mdiff> 1? 's ':' '));
                  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
                } else {
                  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
                  if(ddiff> 0) age.push(ddiff+ ' day'+(ddiff> 1? 's':''));
                }

                if(age.length>1) age.splice(age.length-1,0,' and ');    
                return age.join('');
              }





              


            </script>
          </body>
          </html>

